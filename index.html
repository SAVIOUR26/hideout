<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="HGM Properties POS System - Bar, Restaurant & Lodge Management" />
    <meta name="theme-color" content="#667eea" />
    <title>HGM POS System</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Icons -->
    <link rel="icon" type="image/png" href="/icon.png" />
    <link rel="apple-touch-icon" href="/icon.png" />

    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="HGM POS" />
    <script type="module" crossorigin src="/assets/index-C8Gnj3qQ.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BvrwU59C.css">

    <!-- Safe CSS-based Pesapal hiding -->
    <style>
      /* Hide Pesapal settings card in admin panel */
      div:has(> h3:contains("PesaPal")),
      div:has(> h2:contains("PesaPal")),
      div:has(> h3:contains("Pesapal")),
      div:has(> h2:contains("Pesapal")) {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('ServiceWorker registered:', registration);
            })
            .catch((error) => {
              console.log('ServiceWorker registration failed:', error);
            });
        });
      }
    </script>

    <!-- Minimal, safe Pesapal removal - runs AFTER React is stable -->
    <script>
      // Safe cleanup function that doesn't break React
      function hidePesapalSettings() {
        try {
          // Only hide, never remove elements to avoid breaking React
          const allElements = document.querySelectorAll('h2, h3, h4');

          allElements.forEach(heading => {
            const text = heading.textContent || '';
            if (text.includes('PesaPal') || text.includes('Pesapal')) {
              // Find the parent card/container
              let parent = heading.parentElement;
              let depth = 0;
              while (parent && depth < 10) {
                const className = parent.className || '';
                if (className.includes('card') ||
                    className.includes('panel') ||
                    className.includes('section')) {
                  // Check if this is the settings panel with Pesapal config
                  const parentText = parent.textContent.toLowerCase();
                  if (parentText.includes('consumer') ||
                      parentText.includes('api key') ||
                      parentText.includes('environment')) {
                    parent.style.display = 'none';
                    break;
                  }
                }
                parent = parent.parentElement;
                depth++;
              }
            }
          });

          // Clean up payment button text (safe text replacement)
          const buttons = document.querySelectorAll('button');
          buttons.forEach(btn => {
            if (btn.textContent && btn.textContent.includes('Pesapal')) {
              const originalText = btn.textContent;
              btn.textContent = originalText
                .replace('(Pesapal)', '')
                .replace('Pesapal', '')
                .trim();
            }
          });
        } catch (error) {
          // Silently fail to avoid breaking the page
          console.warn('Pesapal cleanup error:', error);
        }
      }

      // Run only after everything is loaded and stable
      window.addEventListener('load', () => {
        // Wait for React to finish rendering
        setTimeout(() => {
          hidePesapalSettings();

          // Run once more after a delay for late renders
          setTimeout(hidePesapalSettings, 2000);
        }, 1000);
      });

      // Run on navigation (when switching tabs)
      let lastPath = '';
      setInterval(() => {
        const currentPath = window.location.hash;
        if (currentPath !== lastPath) {
          lastPath = currentPath;
          setTimeout(hidePesapalSettings, 300);
        }
      }, 500);
    </script>
  </body>
</html>
